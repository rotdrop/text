{"version":3,"file":"editor-rich.js?v=3c3bd25fbacd71337811","mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACvKA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;ACvCA;;;;;;;;;;;;;;;ACAA","sources":["webpack:///text/src/components/MenuBubble.vue?vue&type=script&lang=js&","webpack:///text/src/views/RichWorkspace.vue?vue&type=script&lang=js&","webpack:///text/src/components/MenuBubble.vue?vue&type=template&id=5496a10a&scoped=true&","webpack:///text/src/views/RichWorkspace.vue?vue&type=template&id=0cce2262&scoped=true&","webpack:///text/src/helpers/files.js","webpack:///text/src/helpers/token.js","webpack:///text/src/components/MenuBubble.vue?vue&type=style&index=0&id=5496a10a&scoped=true&lang=scss&","webpack:///text/src/views/RichWorkspace.vue?vue&type=style&index=0&id=0cce2262&lang=scss&scoped=true&","webpack://text/./src/components/MenuBubble.vue?d26c","webpack://text/./src/views/RichWorkspace.vue?d057","webpack:///text/src/components/MenuBubble.vue","webpack:///text/src/views/RichWorkspace.vue","webpack://text/./src/components/MenuBubble.vue?c446","webpack://text/./src/views/RichWorkspace.vue?b5a2","webpack://text/./src/components/MenuBubble.vue?a9ab","webpack://text/./src/components/MenuBubble.vue?41aa"],"sourcesContent":["import debounce from 'debounce';\nimport { BubbleMenu } from '@tiptap/vue-2';\nimport { getMarkAttributes } from '@tiptap/core';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport { loadState } from '@nextcloud/initial-state';\nimport { Tooltip } from '@nextcloud/vue';\nimport { optimalPath } from './../helpers/files.js';\nimport { useEditorMixin } from './Editor.provider.js';\nimport { LinkIcon, Document, Delete, Check } from '../components/icons.js';\nexport default {\n  name: 'MenuBubble',\n  components: {\n    BubbleMenu: BubbleMenu,\n    LinkIcon: LinkIcon,\n    Document: Document,\n    Delete: Delete,\n    Check: Check\n  },\n  directives: {\n    tooltip: Tooltip\n  },\n  mixins: [useEditorMixin],\n  props: {\n    // used to calculate the position based on the scrollOffset\n    contentWrapper: {\n      type: HTMLDivElement,\n      required: false,\n      default: null\n    },\n    filePath: {\n      type: String,\n      required: false,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      isActive: false,\n      linkUrl: null,\n      linkMenuIsActive: false,\n      isUsingDirectEditing: loadState('text', 'directEditingToken', null) !== null\n    };\n  },\n  mounted: function mounted() {\n    this.$_updateIsActive = debounce(this.updateIsActive.bind(this), 50);\n    this.$editor.on('update', this.$_updateIsActive);\n    this.$editor.on('selectionUpdate', this.$_updateIsActive);\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$editor.off('update', this.$_updateIsActive);\n    this.$editor.off('selectionUpdate', this.$_updateIsActive);\n  },\n  methods: {\n    showLinkMenu: function showLinkMenu() {\n      var _this = this;\n      var attrs = getMarkAttributes(this.$editor.state, 'link');\n      this.linkUrl = attrs.href;\n      this.linkMenuIsActive = true;\n      this.$nextTick(function () {\n        _this.$refs.linkInput.focus();\n      });\n    },\n    hideLinkMenu: function hideLinkMenu() {\n      this.linkUrl = null;\n      this.linkMenuIsActive = false;\n    },\n    selectFile: function selectFile() {\n      var _this2 = this;\n      var currentUser = getCurrentUser();\n      if (!currentUser) {\n        return;\n      }\n      var startPath = this.filePath.split('/').slice(0, -1).join('/');\n      OC.dialogs.filepicker(t('text', 'Select file to link to'), function (file) {\n        var client = OC.Files.getClient();\n        client.getFileInfo(file).then(function (_status, fileInfo) {\n          var path = optimalPath(_this2.filePath, \"\".concat(fileInfo.path, \"/\").concat(fileInfo.name));\n          var encodedPath = path.split('/').map(encodeURIComponent).join('/');\n          var dirMarker = fileInfo.mimetype === 'httpd/unix-directory' ? '/' : '';\n          var href = \"\".concat(encodedPath).concat(dirMarker, \"?fileId=\").concat(fileInfo.id);\n          _this2.$editor.chain().setLink({\n            href: href\n          }).focus().run();\n          _this2.hideLinkMenu();\n        });\n      }, false, [], true, undefined, startPath, {\n        allowDirectoryChooser: true\n      });\n    },\n    setLinkUrl: function setLinkUrl() {\n      var url = this.linkUrl;\n      // Heuristics for determining if we need a https:// prefix.\n      var noPrefixes = [/^[a-zA-Z]+:/,\n      // url with protocol (\"mailTo:email@domain.tld\")\n      /^\\//,\n      // absolute path\n      /\\?fileId=/,\n      // relative link with fileId\n      /^\\.\\.?\\//,\n      // relative link starting with ./ or ../\n      /^[^.]*[/$]/,\n      // no dots before first '/' - not a domain name\n      /^#/ // url fragment\n      ];\n\n      if (url && !noPrefixes.find(function (regex) {\n        return url.match(regex);\n      })) {\n        url = 'https://' + url;\n      }\n\n      // Avoid issues when parsing urls later on in markdown that might be entered in an invalid format (e.g. \"mailto: example@example.com\")\n      var href = url.replaceAll(' ', '%20');\n      this.$editor.chain().setLink({\n        href: href\n      }).focus().run();\n      this.hideLinkMenu();\n    },\n    removeLinkUrl: function removeLinkUrl() {\n      this.$editor.chain().unsetLink().focus().run();\n    },\n    updateIsActive: function updateIsActive() {\n      this.isActive = this.$editor.isActive('link');\n    }\n  }\n};","import axios from '@nextcloud/axios';\nimport { generateOcsUrl } from '@nextcloud/router';\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus';\nimport { logger } from '../helpers/logger.js';\nvar IS_PUBLIC = !!document.getElementById('isPublic');\nvar WORKSPACE_URL = generateOcsUrl('apps/text' + (IS_PUBLIC ? '/public' : '') + '/workspace', 2);\nexport default {\n  name: 'RichWorkspace',\n  components: {\n    Editor: function Editor() {\n      return import( /* webpackChunkName: \"editor\" */'./../components/Editor.vue');\n    }\n  },\n  props: {\n    path: {\n      type: String,\n      required: true\n    },\n    active: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data: function data() {\n    return {\n      focus: false,\n      folder: null,\n      file: null,\n      loaded: false,\n      ready: false,\n      autofocus: false,\n      autohide: true,\n      darkTheme: OCA.Accessibility && OCA.Accessibility.theme === 'dark',\n      enabled: OCA.Text.RichWorkspaceEnabled\n    };\n  },\n  computed: {\n    shareToken: function shareToken() {\n      var _document$getElementB;\n      return (_document$getElementB = document.getElementById('sharingToken')) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.value;\n    },\n    canCreate: function canCreate() {\n      return !!(this.folder && this.folder.permissions & OC.PERMISSION_CREATE);\n    },\n    showEmptyWorkspace: function showEmptyWorkspace() {\n      return (!this.file || this.autofocus && !this.ready) && this.canCreate;\n    }\n  },\n  watch: {\n    path: function path() {\n      this.getFileInfo();\n    },\n    focus: function focus(newValue) {\n      if (!newValue) {\n        document.querySelector('#rich-workspace .text-editor__main').scrollTo(0, 0);\n      }\n    }\n  },\n  mounted: function mounted() {\n    if (this.enabled) {\n      this.getFileInfo();\n    }\n    subscribe('Text::showRichWorkspace', this.showRichWorkspace);\n    subscribe('Text::hideRichWorkspace', this.hideRichWorkspace);\n    this.listenKeydownEvents();\n  },\n  beforeDestroy: function beforeDestroy() {\n    unsubscribe('Text::showRichWorkspace', this.showRichWorkspace);\n    unsubscribe('Text::hideRichWorkspace', this.hideRichWorkspace);\n    this.unlistenKeydownEvents();\n  },\n  methods: {\n    onBlur: function onBlur() {\n      this.listenKeydownEvents();\n    },\n    onFocus: function onFocus() {\n      this.focus = true;\n      this.unlistenKeydownEvents();\n    },\n    reset: function reset() {\n      var _this = this;\n      this.file = null;\n      this.focus = false;\n      this.$nextTick(function () {\n        _this.creating = false;\n        _this.getFileInfo();\n      });\n    },\n    getFileInfo: function getFileInfo() {\n      var _this2 = this;\n      this.loaded = false;\n      this.autofocus = false;\n      this.ready = false;\n      var params = {\n        path: this.path\n      };\n      if (IS_PUBLIC) {\n        params.shareToken = this.shareToken;\n      }\n      return axios.get(WORKSPACE_URL, {\n        params: params\n      }).then(function (response) {\n        var data = response.data.ocs.data;\n        _this2.folder = data.folder || null;\n        _this2.file = data.file;\n        _this2.editing = true;\n        _this2.loaded = true;\n        return true;\n      }).catch(function (error) {\n        if (error.response.data.ocs && error.response.data.ocs.data.folder) {\n          _this2.folder = error.response.data.ocs.data.folder;\n        } else {\n          _this2.folder = null;\n        }\n        _this2.file = null;\n        _this2.loaded = true;\n        _this2.ready = true;\n        _this2.creating = false;\n        return false;\n      });\n    },\n    createNew: function createNew() {\n      var _this3 = this;\n      if (this.creating) {\n        return;\n      }\n      this.creating = true;\n      this.getFileInfo().then(function (workspaceFileExists) {\n        if (!workspaceFileExists) {\n          return window.FileList.createFile('Readme.md', {\n            scrollTo: false,\n            animate: false\n          }).then(function (status, data) {\n            return _this3.getFileInfo();\n          });\n        }\n      }).then(function () {\n        _this3.autofocus = true;\n      }).catch(function (error) {\n        logger.warn('Create readme failed', {\n          error: error\n        });\n      });\n    },\n    showRichWorkspace: function showRichWorkspace() {\n      this.enabled = true;\n      this.getFileInfo();\n    },\n    hideRichWorkspace: function hideRichWorkspace() {\n      this.enabled = false;\n    },\n    listenKeydownEvents: function listenKeydownEvents() {\n      window.addEventListener('keydown', this.onKeydown);\n    },\n    unlistenKeydownEvents: function unlistenKeydownEvents() {\n      clearInterval(this.$_timeoutAutohide);\n      window.removeEventListener('keydown', this.onKeydown);\n    },\n    onTimeoutAutohide: function onTimeoutAutohide() {\n      this.autohide = true;\n    },\n    onKeydown: function onKeydown(e) {\n      if (e.key !== 'Tab') {\n        return;\n      }\n\n      // remove previous timeout\n      clearInterval(this.$_timeoutAutohide);\n      this.autohide = false;\n\n      // schedule to normal behaviour\n      this.$_timeoutAutohide = setTimeout(this.onTimeoutAutohide, 7000); // 7s\n    }\n  }\n};","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c;\n  return _c(\"BubbleMenu\", {\n    staticClass: \"menububble\",\n    attrs: {\n      editor: _vm.$editor,\n      \"tippy-options\": {\n        onHide: _vm.hideLinkMenu,\n        duration: 200,\n        placement: \"bottom\"\n      },\n      \"data-text-el\": \"menu-bubble\"\n    }\n  }, [_vm.linkMenuIsActive ? _c(\"form\", {\n    staticClass: \"menububble__form\",\n    on: {\n      submit: function submit($event) {\n        $event.preventDefault();\n        return _vm.setLinkUrl();\n      }\n    }\n  }, [_c(\"input\", {\n    directives: [{\n      name: \"model\",\n      rawName: \"v-model\",\n      value: _vm.linkUrl,\n      expression: \"linkUrl\"\n    }],\n    ref: \"linkInput\",\n    staticClass: \"menububble__input\",\n    attrs: {\n      type: \"text\",\n      placeholder: \"https://\"\n    },\n    domProps: {\n      value: _vm.linkUrl\n    },\n    on: {\n      keydown: function keydown($event) {\n        if (!$event.type.indexOf(\"key\") && _vm._k($event.keyCode, \"esc\", 27, $event.key, [\"Esc\", \"Escape\"])) return null;\n        return _vm.hideLinkMenu.apply(null, arguments);\n      },\n      input: function input($event) {\n        if ($event.target.composing) return;\n        _vm.linkUrl = $event.target.value;\n      }\n    }\n  }), _vm._v(\" \"), _c(\"button\", {\n    staticClass: \"menububble__button\",\n    attrs: {\n      \"data-text-bubble-action\": \"confirm\",\n      type: \"button\",\n      tabindex: \"0\"\n    },\n    on: {\n      click: function click($event) {\n        return _vm.setLinkUrl();\n      }\n    }\n  }, [_c(\"Check\")], 1)]) : [_c(\"button\", {\n    staticClass: \"menububble__button\",\n    class: {\n      \"is-active\": _vm.isActive\n    },\n    attrs: {\n      \"data-text-bubble-action\": \"add-link\"\n    },\n    on: {\n      click: function click($event) {\n        return _vm.showLinkMenu();\n      }\n    }\n  }, [_c(\"LinkIcon\"), _vm._v(\" \"), _c(\"span\", {\n    staticClass: \"menububble__buttontext\"\n  }, [_vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm.isActive ? _vm.t(\"text\", \"Update Link\") : _vm.t(\"text\", \"Add Link\")) + \"\\n\\t\\t\\t\")])], 1), _vm._v(\" \"), !_vm.isUsingDirectEditing ? _c(\"button\", {\n    staticClass: \"menububble__button\",\n    class: {\n      \"is-active\": _vm.isActive\n    },\n    attrs: {\n      \"data-text-bubble-action\": \"add-file\"\n    },\n    on: {\n      click: function click($event) {\n        return _vm.selectFile();\n      }\n    }\n  }, [_c(\"Document\"), _vm._v(\" \"), _c(\"span\", {\n    staticClass: \"menububble__buttontext\"\n  }, [_vm._v(_vm._s(_vm.t(\"text\", \"Link file\")))])], 1) : _vm._e(), _vm._v(\" \"), _vm.isActive ? _c(\"button\", {\n    staticClass: \"menububble__button\",\n    class: {\n      \"is-active\": _vm.isActive\n    },\n    attrs: {\n      \"data-text-bubble-action\": \"remove-link\"\n    },\n    on: {\n      click: function click($event) {\n        return _vm.removeLinkUrl();\n      }\n    }\n  }, [_c(\"Delete\"), _vm._v(\" \"), _c(\"span\", {\n    staticClass: \"menububble__buttontext\"\n  }, [_vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm.t(\"text\", \"Remove Link\")) + \"\\n\\t\\t\\t\")])], 1) : _vm._e()]], 2);\n};\nvar staticRenderFns = [];\nrender._withStripped = true;\nexport { render, staticRenderFns };","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c;\n  return _vm.enabled && _vm.active ? _c(\"div\", {\n    class: {\n      \"icon-loading\": !_vm.loaded || !_vm.ready,\n      focus: _vm.focus,\n      dark: _vm.darkTheme,\n      creatable: _vm.canCreate,\n      empty: _vm.showEmptyWorkspace\n    },\n    attrs: {\n      id: \"rich-workspace\"\n    }\n  }, [_vm.showEmptyWorkspace ? _c(\"a\", {\n    staticClass: \"empty-workspace\",\n    attrs: {\n      tabindex: \"0\"\n    },\n    on: {\n      keyup: [function ($event) {\n        if (!$event.type.indexOf(\"key\") && _vm._k($event.keyCode, \"enter\", 13, $event.key, \"Enter\")) return null;\n        return _vm.createNew.apply(null, arguments);\n      }, function ($event) {\n        if (!$event.type.indexOf(\"key\") && _vm._k($event.keyCode, \"space\", 32, $event.key, [\" \", \"Spacebar\"])) return null;\n        return _vm.createNew.apply(null, arguments);\n      }],\n      click: _vm.createNew\n    }\n  }, [_c(\"p\", {\n    staticClass: \"placeholder\"\n  }, [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"text\", \"Add notes, lists or links …\")) + \"\\n\\t\\t\")])]) : _vm._e(), _vm._v(\" \"), _vm.file ? _c(\"Editor\", {\n    directives: [{\n      name: \"show\",\n      rawName: \"v-show\",\n      value: _vm.ready,\n      expression: \"ready\"\n    }],\n    key: _vm.file.path,\n    attrs: {\n      \"file-id\": _vm.file.id,\n      \"relative-path\": _vm.file.path,\n      \"share-token\": _vm.shareToken,\n      mime: _vm.file.mimetype,\n      autofocus: _vm.autofocus,\n      autohide: _vm.autohide,\n      active: \"\",\n      \"rich-workspace\": \"\"\n    },\n    on: {\n      ready: function ready($event) {\n        _vm.ready = true;\n      },\n      focus: _vm.onFocus,\n      blur: _vm.onBlur,\n      error: _vm.reset\n    }\n  }) : _vm._e()], 1) : _vm._e();\n};\nvar staticRenderFns = [];\nrender._withStripped = true;\nexport { render, staticRenderFns };","/*\n * @copyright Copyright (c) 2019 Julius Härtl <jus@bitgrid.net>\n *\n * @author Julius Härtl <jus@bitgrid.net>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { loadState } from '@nextcloud/initial-state';\nimport { subscribe } from '@nextcloud/event-bus';\nimport { openMimetypes } from './mime.js';\nimport { getSharingToken } from './token.js';\nimport RichWorkspace from '../views/RichWorkspace.vue';\nimport { imagePath } from '@nextcloud/router';\nimport store from '../store/index.js';\nvar FILE_ACTION_IDENTIFIER = 'Edit with text app';\nvar optimalPath = function optimalPath(from, to) {\n  var current = from.split('/');\n  var target = to.split('/');\n  current.pop(); // ignore filename\n  while (current[0] === target[0]) {\n    current.shift();\n    target.shift();\n  }\n  var relativePath = current.fill('..').concat(target);\n  var absolutePath = to.split('/');\n  return relativePath.length < absolutePath.length ? relativePath.join('/') : to;\n};\nvar registerFileCreate = function registerFileCreate() {\n  var newFileMenuPlugin = {\n    attach: function attach(menu) {\n      var fileList = menu.fileList;\n\n      // only attach to main file list, public view is not supported yet\n      if (fileList.id !== 'files' && fileList.id !== 'files.public') {\n        return;\n      }\n\n      // register the new menu entry\n      menu.addMenuEntry({\n        id: 'file',\n        displayName: t('text', 'New text file'),\n        templateName: t('text', 'New text file') + '.' + loadState('text', 'default_file_extension'),\n        iconClass: 'icon-filetype-text',\n        fileType: 'file',\n        actionHandler: function actionHandler(name) {\n          fileList.createFile(name).then(function (status, data) {\n            var fileInfoModel = new OCA.Files.FileInfoModel(data);\n            if (typeof OCA.Viewer !== 'undefined') {\n              OCA.Files.fileActions.triggerAction('view', fileInfoModel, fileList);\n            } else if (typeof OCA.Viewer === 'undefined') {\n              OCA.Files.fileActions.triggerAction(FILE_ACTION_IDENTIFIER, fileInfoModel, fileList);\n            }\n          });\n        }\n      });\n    }\n  };\n  OC.Plugins.register('OCA.Files.NewFileMenu', newFileMenuPlugin);\n};\nvar registerFileActionFallback = function registerFileActionFallback() {\n  var sharingToken = getSharingToken();\n  var filesTable = document.querySelector('#preview table.files-filestable');\n  if (!sharingToken || !filesTable) {\n    var ViewerRoot = document.createElement('div');\n    ViewerRoot.id = 'text-viewer-fallback';\n    document.body.appendChild(ViewerRoot);\n    var registerAction = function registerAction(mime) {\n      return OCA.Files.fileActions.register(mime, FILE_ACTION_IDENTIFIER, OC.PERMISSION_UPDATE | OC.PERMISSION_READ, imagePath('core', 'actions/rename'), function (filename) {\n        var file = window.FileList.findFile(filename);\n        Promise.all([import('vue'), import( /* webpackChunkName: \"files-modal\" */'./../components/PublicFilesEditor.vue')]).then(function (imports) {\n          var path = window.FileList.getCurrentDirectory() + '/' + filename;\n          var Vue = imports[0].default;\n          Vue.prototype.t = window.t;\n          Vue.prototype.n = window.n;\n          Vue.prototype.OCA = window.OCA;\n          var Editor = imports[1].default;\n          var vm = new Vue({\n            render: function render(h) {\n              // eslint-disable-line\n              var self = this;\n              return h(Editor, {\n                props: {\n                  fileId: file ? file.id : null,\n                  active: true,\n                  shareToken: sharingToken,\n                  relativePath: path,\n                  mimeType: file.mimetype\n                },\n                on: {\n                  close: function close() {\n                    // eslint-disable-line\n                    self.$destroy();\n                  }\n                }\n              });\n            }\n          });\n          vm.$mount(ViewerRoot);\n        });\n      }, t('text', 'Edit'));\n    };\n    for (var i = 0; i < openMimetypes.length; i++) {\n      registerAction(openMimetypes[i]);\n      OCA.Files.fileActions.setDefault(openMimetypes[i], FILE_ACTION_IDENTIFIER);\n    }\n  }\n};\nvar FilesWorkspacePlugin = {\n  el: null,\n  attach: function attach(fileList) {\n    if (fileList.id !== 'files' && fileList.id !== 'files.public') {\n      return;\n    }\n    this.el = document.createElement('div');\n    fileList.registerHeader({\n      id: 'workspace',\n      el: this.el,\n      render: this.render.bind(this),\n      priority: 10\n    });\n  },\n  render: function render(fileList) {\n    var _this = this;\n    if (fileList.id !== 'files' && fileList.id !== 'files.public') {\n      return;\n    }\n    import('vue').then(function (module) {\n      var Vue = module.default;\n      _this.el.id = 'files-workspace-wrapper';\n      Vue.prototype.t = window.t;\n      Vue.prototype.n = window.n;\n      Vue.prototype.OCA = window.OCA;\n      var View = Vue.extend(RichWorkspace);\n      var vm = new View({\n        propsData: {\n          path: fileList.getCurrentDirectory()\n        },\n        store: store\n      }).$mount(_this.el);\n      subscribe('files:navigation:changed', function () {\n        // Expose if the default file list is active to the component\n        // to only render the workspace if the file list is actually visible\n        vm.active = OCA.Files.App.getCurrentFileList() === fileList;\n      });\n      fileList.$el.on('urlChanged', function (data) {\n        vm.path = data.dir.toString();\n      });\n      fileList.$el.on('changeDirectory', function (data) {\n        vm.path = data.dir.toString();\n      });\n    });\n  }\n};\nexport { optimalPath, registerFileActionFallback, registerFileCreate, FilesWorkspacePlugin, FILE_ACTION_IDENTIFIER };","var getSharingToken = function getSharingToken() {\n  return document.getElementById('sharingToken') ? document.getElementById('sharingToken').value : null;\n};\nexport { getSharingToken };","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".menububble[data-v-5496a10a] {\\n  display: flex;\\n  z-index: 10020;\\n  background: var(--color-main-background-translucent);\\n  box-shadow: 0 1px 5px var(--color-box-shadow);\\n  border-radius: var(--border-radius-large);\\n  overflow: hidden;\\n  padding: 0;\\n  margin-left: 10px;\\n  height: 44px;\\n}\\n.menububble__button[data-v-5496a10a] {\\n  flex-grow: 1;\\n  border: 0;\\n  padding: 0.9rem 0.7rem;\\n  margin: 0;\\n  border-radius: 0;\\n  cursor: pointer;\\n  background-color: var(--color-main-background);\\n  border-right: 1px solid var(--color-border);\\n  display: flex;\\n  align-items: center;\\n}\\n.menububble__button[data-v-5496a10a]:focus, .menububble__button[data-v-5496a10a]:hover {\\n  background-color: var(--color-background-hover);\\n  border: 0;\\n  border-right: 1px solid var(--color-border) !important;\\n}\\n.menububble__button[data-v-5496a10a]:last-child {\\n  border: 0 !important;\\n}\\n.menububble__buttontext[data-v-5496a10a] {\\n  padding: 0.4rem;\\n  padding-right: 0;\\n}\\n.menububble__form[data-v-5496a10a] {\\n  display: flex;\\n  align-items: center;\\n}\\n.menububble__input[data-v-5496a10a] {\\n  font: inherit;\\n  border: none;\\n  background: transparent;\\n  min-width: 250px;\\n  margin: 0 0.5em 0 1em;\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"#rich-workspace[data-v-0cce2262] {\\n  padding: 0 50px;\\n  /* Slightly reduce vertical space */\\n  margin-bottom: -24px;\\n  text-align: left;\\n  max-height: 0;\\n  transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\\n  z-index: 61;\\n  position: relative;\\n}\\n#rich-workspace.creatable[data-v-0cce2262] {\\n  min-height: 90px;\\n}\\n\\n/* For subfolders, where there are no Recommendations */\\n#rich-workspace[data-v-0cce2262]:only-child {\\n  margin-bottom: 0;\\n}\\n.empty-workspace[data-v-0cce2262] {\\n  cursor: pointer;\\n  display: block;\\n  padding-top: 43px;\\n  color: var(--color-text-maxcontrast);\\n}\\n#rich-workspace[data-v-0cce2262] div[contenteditable=false] {\\n  width: 100%;\\n  padding: 0px;\\n  background-color: var(--color-main-background);\\n  opacity: 1;\\n  border: none;\\n}\\n#rich-workspace[data-v-0cce2262] .text-editor {\\n  height: 100%;\\n  position: unset !important;\\n  top: auto !important;\\n}\\n#rich-workspace[data-v-0cce2262] .text-editor__wrapper {\\n  position: unset !important;\\n  overflow: visible;\\n}\\n#rich-workspace[data-v-0cce2262] .text-editor__main {\\n  overflow: visible !important;\\n}\\n#rich-workspace[data-v-0cce2262] .content-wrapper {\\n  overflow: scroll !important;\\n  max-height: calc(40vh - 50px);\\n  padding-left: 10px;\\n  padding-bottom: 60px; /* ensure menububble fits below */\\n}\\n#rich-workspace[data-v-0cce2262] .text-editor__wrapper .ProseMirror {\\n  padding: 0px;\\n  margin: 0;\\n}\\n#rich-workspace[data-v-0cce2262] .editor__content {\\n  margin: 0;\\n}\\n#rich-workspace.focus[data-v-0cce2262] {\\n  max-height: 50vh;\\n}\\n#rich-workspace[data-v-0cce2262]:not(.focus) {\\n  max-height: 30vh;\\n  position: relative;\\n  overflow: hidden;\\n}\\n#rich-workspace[data-v-0cce2262]:not(.focus):not(.icon-loading):not(.empty):after {\\n  content: \\\"\\\";\\n  position: absolute;\\n  z-index: 1;\\n  bottom: 0;\\n  left: 0;\\n  pointer-events: none;\\n  background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), var(--color-main-background));\\n  width: 100%;\\n  height: 4em;\\n}\\n#rich-workspace.dark[data-v-0cce2262]:not(.focus):not(.icon-loading):after {\\n  background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), var(--color-main-background));\\n}\\n@media only screen and (max-width: 1024px) {\\n#rich-workspace[data-v-0cce2262]:not(.focus) {\\n    max-height: 30vh;\\n}\\n}\\nhtml.ie #rich-workspace[data-v-0cce2262]  .text-editor {\\n  position: initial;\\n}\\nhtml.ie #rich-workspace[data-v-0cce2262]  .text-editor__wrapper {\\n  position: relative !important;\\n  top: auto !important;\\n}\\nhtml.ie #rich-workspace[data-v-0cce2262]  .text-editor__main {\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden !important;\\n}\\nhtml.ie #rich-workspace[data-v-0cce2262]  .menubar {\\n  position: relative;\\n  overflow: hidden;\\n  flex-shrink: 0;\\n  height: 44px;\\n  top: auto;\\n}\\nhtml.ie #rich-workspace[data-v-0cce2262]  .text-editor__main > div:nth-child(2) {\\n  min-height: 44px;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  flex-shrink: 1;\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=style&index=0&id=5496a10a&scoped=true&lang=scss&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=style&index=0&id=5496a10a&scoped=true&lang=scss&\";\n       export default content && content.locals ? content.locals : undefined;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RichWorkspace.vue?vue&type=style&index=0&id=0cce2262&lang=scss&scoped=true&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RichWorkspace.vue?vue&type=style&index=0&id=0cce2262&lang=scss&scoped=true&\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./MenuBubble.vue?vue&type=template&id=5496a10a&scoped=true&\"\nimport script from \"./MenuBubble.vue?vue&type=script&lang=js&\"\nexport * from \"./MenuBubble.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MenuBubble.vue?vue&type=style&index=0&id=5496a10a&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5496a10a\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/var/www/dev1/htdocs/nextcloud-git-25/apps/text/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('5496a10a')) {\n      api.createRecord('5496a10a', component.options)\n    } else {\n      api.reload('5496a10a', component.options)\n    }\n    module.hot.accept(\"./MenuBubble.vue?vue&type=template&id=5496a10a&scoped=true&\", function () {\n      api.rerender('5496a10a', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/MenuBubble.vue\"\nexport default component.exports","import { render, staticRenderFns } from \"./RichWorkspace.vue?vue&type=template&id=0cce2262&scoped=true&\"\nimport script from \"./RichWorkspace.vue?vue&type=script&lang=js&\"\nexport * from \"./RichWorkspace.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RichWorkspace.vue?vue&type=style&index=0&id=0cce2262&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0cce2262\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/var/www/dev1/htdocs/nextcloud-git-25/apps/text/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('0cce2262')) {\n      api.createRecord('0cce2262', component.options)\n    } else {\n      api.reload('0cce2262', component.options)\n    }\n    module.hot.accept(\"./RichWorkspace.vue?vue&type=template&id=0cce2262&scoped=true&\", function () {\n      api.rerender('0cce2262', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/RichWorkspace.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=script&lang=js&\"","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RichWorkspace.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RichWorkspace.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/loaders/templateLoader.js??ruleSet[1].rules[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=template&id=5496a10a&scoped=true&\"","export * from \"-!../../node_modules/style-loader/dist/cjs.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/dist/cjs.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuBubble.vue?vue&type=style&index=0&id=5496a10a&scoped=true&lang=scss&\""],"names":[],"sourceRoot":""}